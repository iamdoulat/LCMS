
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Allow read and write access to lc_entries for any authenticated user
    match /lc_entries/{lcEntryId} {
      allow read, write: if request.auth != null;
    }

    // Allow read and write access to customers for any authenticated user
    match /customers/{customerId} {
      allow read, write: if request.auth != null;
    }

    // Allow read and write access to suppliers for any authenticated user
    match /suppliers/{supplierId} {
      allow read, write: if request.auth != null;
    }

    // Rule for the company_profile collection
    match /company_profile/main_profile {
      allow read: if true; // Or 'if request.auth != null;' if you only want logged-in users to see it
      allow write: if request.auth != null; // Consider restricting to admins for production
    }

    // Rules for the 'users' collection (Firestore profiles)
    match /users/{userId} {
      allow read: if request.auth != null;
      // Allow a user to write to their own document, or allow admins to write to any user document
      // You might want to adjust this based on whether admins can edit user profiles in your app
      allow write: if request.auth != null && (request.auth.uid == userId || get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role in ['Admin', 'Super Admin']);
    }

    // Allow read and write access to proforma_invoices for any authenticated user
    match /proforma_invoices/{piId} {
      allow read, write: if request.auth != null;
    }

    // Allow read and write access to installation_reports for any authenticated user
    match /installation_reports/{reportId} {
      allow read, write: if request.auth != null;
    }

    // --- NEW RULES FOR DEMO MACHINE MANAGEMENT ---
    // Allow read and write access to demo_machine_factories for any authenticated user
    match /demo_machine_factories/{factoryId} {
      allow read, write: if request.auth != null;
    }

    // Allow read and write access to demo_machines for any authenticated user
    match /demo_machines/{machineId} {
      allow read, write: if request.auth != null;
    }

    // Allow read and write access to demo_machine_applications for any authenticated user
    match /demo_machine_applications/{applicationId} {
      allow read, write: if request.auth != null;
    }
    // --- END NEW RULES FOR DEMO MACHINE MANAGEMENT ---

    // Rules for the 'items' collection
    match /items/{itemId} {
      allow read, write: if request.auth != null;
    }

    // Rules for the 'quotes' collection
    match /quotes/{quoteId} {
      allow read, write: if request.auth != null;
    }
  }
}
